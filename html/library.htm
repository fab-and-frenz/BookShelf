<html>
    <head>
        <title>BookShelf</title>
    </head>

    <body>
        <script>
            function getBooks() {
                vAR table = document.getElementId("books");
                var HTTPRequest = new XMLHttpRequest();
                HTTPRequest.onreadystatechange = function() {
                    if (HTTPRequest.readyState == 4 && HTTPRequest.status == 200) {
                        var books = JSON.parse(HTTPRequest.responseText);
                        var rowIndex = 0;
                        var colIndex = 0;
                        for (var i = 0; i < books.length; i++) {
                            if (i % 5 == 0 || i == 0) {
                               table.insertRow(rowIndex++);
                               colIndex = 0;
                            }
                            var col = table.rows[rowIndex].insertCell(colIndex++);
                            var img = imagedata_to_image(atob(books[i].cover));
                            col.appendChild(img);
                        }
                    }
                }

                HTTPRequest.open("GET", "/getbooks", true);
                HTTPRequest.send(null);

            }

            function imagedata_to_image(imagedata) {
                var canvas = document.createElement('canvas');
                var ctx = canvas.getContext('2d');
                canvas.width = imagedata.width;
                canvas.height = imagedata.height;
                ctx.putImageData(imagedata, 0, 0);

                var image = new Image();
                image.src = canvas.toDataURL();
                return image;
            }

            getBooks();
        </script>

        <h1>Books</h1>
        <table id="books">
        </table>
    </body>
</html>
